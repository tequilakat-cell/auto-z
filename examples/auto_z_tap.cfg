# AUTO_Z_TAP configuration
#
# Include this file (or copy sections into printer.cfg) and tune values
# for your machine.  Most parameters have sensible defaults based on your
# probe_type, so a minimal config is all you need to get started.
#
# Required: [save_variables] for calibration persistence.
[save_variables]
filename: ~/printer_data/config/variables.cfg

# ---------------------------------------------------------------------------
# Minimal config - CNC Tap
# ---------------------------------------------------------------------------
# Just set probe_type and reference position.  Everything else uses the
# tap preset defaults (5 samples, 0.015mm spread limit, 2 warmup taps,
# thermal soak enabled, etc.).
#
# [auto_z_tap]
# probe_type: tap
# reference_xy_position: 150, 150

# ---------------------------------------------------------------------------
# Minimal config - Microprobe
# ---------------------------------------------------------------------------
# [auto_z_tap]
# probe_type: microprobe
# reference_xy_position: 150, 150

# ---------------------------------------------------------------------------
# Minimal config - BLTouch
# ---------------------------------------------------------------------------
# [auto_z_tap]
# probe_type: bltouch
# reference_xy_position: 150, 150

# ---------------------------------------------------------------------------
# Full config with all parameters
# ---------------------------------------------------------------------------

[auto_z_tap]
# Probe type: tap, microprobe, bltouch, inductive, generic
# Sets sensible defaults for all probe parameters.  Every value below can
# still be overridden explicitly.
probe_type: tap

# Klipper probe object name (usually 'probe').
probe_object: probe

# Where to sample the bed.  Use a point representative of your print area.
reference_xy_position: 150, 150

# Auto-home if axes are not homed.
auto_home: True
home_command: G28

# Clear bed mesh before probing for accurate results.
clear_bed_mesh_before_probe: True

# Safe Z height for XY travel moves.
safe_z: 10

# Z height to start probing from.
probe_start_z: 8

# XY travel speed (mm/s).
travel_speed: 200

# Probe sample count.  Preset default depends on probe_type.
# probe_samples: 5

# How to aggregate samples: median or average.
probe_samples_result: median

# Max spread between probe samples (mm).  Preset default depends on probe_type.
# max_probe_spread: 0.015

# Retry count when spread exceeds limit.
# probe_retries: 3

# Z retract distance between probe samples (mm).
# sample_retract_dist: 1.0

# Max allowed drift from calibration reference (mm).
# max_drift: 0.80

# Z hop after probing during calibration.
calibration_z_hop: 5.0

# Warm-up taps: throwaway probe taps before the real measurement.
# Settles thermal expansion, ooze, and mechanical play.
# Preset default: 2 for tap, 1 for bltouch/inductive, 0 for microprobe.
# warmup_taps: 2

# Thermal soak: wait for temperature rate-of-change to stabilize before
# probing.  Critical for CNC Tap and inductive probes.
# Preset default: True for tap/inductive, False for others.
# thermal_soak: True
# thermal_soak_threshold: 0.3
# thermal_soak_timeout: 300
# thermal_soak_sensors: heater_bed

# Safety limits: reject computed offsets outside this range.
# Prevents nozzle crashes or air printing from bad calibration data.
# safe_offset_min: -0.500
# safe_offset_max: 0.500

# Require [save_variables] for calibration persistence.
require_save_variables: True
variable_prefix: auto_z_tap

# Global adjustment layer (applies every run).
global_offset: 0.000

# Linear temperature coefficients.
# Preset defaults depend on probe_type (tap has higher coefficients).
# bed_temp_coeff: 0.00010
# hotend_temp_coeff: 0.00005
# chamber_temp_coeff: 0.00005

# Polynomial temperature coefficients (override linear if set).
# Format: c1, c2, c3...  Applied as c1*(T-Tref) + c2*(T-Tref)^2 + ...
# Useful for inductive probes with non-linear temperature response.
# bed_temp_poly:
# hotend_temp_poly:
# chamber_temp_poly:

# First layer height compensation.
first_layer_coeff: 0.00000
first_layer_reference: 0.20

# If not set, temperature references fall back to calibration-time values.
# bed_temp_reference: 60
# hotend_temp_reference: 210
# chamber_temp_reference: 35

# Automatic profile selection and runtime behavior.
default_profile: pei
chamber_sensor: temperature_sensor chamber
max_total_adjustment: 0.600
apply_move: False
persist_last_run: True
report_breakdown: True

# Probe after calibration to verify accuracy.
calibration_validate: False

# Probe health monitoring (rolling statistics across runs).
probe_health_tracking: True

# Let health tracker adjust sample count based on confidence.
adaptive_samples: False

# ---------------------------------------------------------------------------
# Adjustment profiles
# ---------------------------------------------------------------------------
# Profiles apply additional offsets based on material, build surface,
# nozzle, and/or probe type.  Profiles auto-match based on filters
# passed via gcode parameters (MATERIAL=, BUILD_SURFACE=, NOZZLE=).

# Smooth PEI sheet.
[auto_z_tap_adjustment pei]
priority: 10
build_surface: pei
offset: 0.000
bed_temp_coeff: 0.00015
hotend_temp_coeff: 0.00005

# Textured PEI - needs more squish.
[auto_z_tap_adjustment textured]
priority: 20
build_surface: textured
offset: -0.015

# PLA material.
[auto_z_tap_adjustment pla]
priority: 30
material: pla
offset: 0.000
bed_temp_coeff: 0.00008
hotend_temp_coeff: 0.00003
first_layer_coeff: -0.25000
first_layer_reference: 0.20

# PETG material.
[auto_z_tap_adjustment petg]
priority: 40
material: petg
offset: 0.010
bed_temp_coeff: 0.00010
hotend_temp_coeff: 0.00002
first_layer_coeff: -0.20000
first_layer_reference: 0.24

# Example: probe-type-specific profile (only active for inductive probes).
# [auto_z_tap_adjustment inductive_bed_comp]
# priority: 5
# probe_type: inductive
# offset: 0.000
# bed_temp_poly: 0.00080, 0.0000005
